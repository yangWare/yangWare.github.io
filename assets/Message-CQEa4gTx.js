import{s as m,l as v,u as h,_ as M,c as S,b as C,o as x,a as g,q,w as P,f as B,k as L,v as O,t as R}from"./main-CR2e-UWp.js";const H={1:{id:1,name:"初始地图",description:"这是一个初始地图",bg_image:"/assets/map.png",width:1e4,height:1e4,start_location_id:1,locations:{1:{id:1,name:"燧石部落",description:"进入燧石部落，你的启程之地，在这里可以使用锻造所打造装备，并补充药水。",adjacent_locations:[2,3,4],position:{x:400,y:400},npc:{forge:{level:1},shop:{items:[{id:"potion_001",price:100},{id:"potion_002",price:200},{id:"potion_003",price:400}]}}},2:{id:2,name:"深渊矿井·入口",description:"进入深渊矿井。远古文明血晶矿脉，如今早已废弃，只有隐隐的低语从深处传来，请不要随意靠近。",adjacent_locations:[1],position:{x:200,y:400}},3:{id:3,name:"雾隐古林",description:"进入雾隐古林。经常被薄雾笼罩的原始森林，树干上生长着散发微弱蓝光的苔藓，地面覆盖着巨型蕨类与史前菌类。林间偶尔可见风化严重的石柱，刻有远古部族遗留的粗犷符文。溪流中漂浮着荧光浮萍，为冒险者提供天然光源。",adjacent_locations:[1,4],position:{x:600,y:400},enemy:{shijiaoyezhu:{probability:.7,max_count:100},zhendimanniu:{probability:.2,max_count:50},jianchihu:{probability:.05,max_count:10}}},4:{id:4,name:"裂蹄草原",description:"进入裂蹄草原。一片被远古巨兽踏裂的黄金草原，地缝中蒸腾着硫磺雾气，巨型草叶在风中发出编钟般的共鸣。随处可见半埋在地表的生物肋骨化石形成天然拱门，雷暴云永远在北方地平线闪烁，但受神秘力量制约不会靠近探索区。黎明时分，草海会浮现荧光兽群奔跑的虚影，指引隐藏的水源位置。",adjacent_locations:[1,3],position:{x:500,y:600},enemy:{jingjilu:{probability:.7,max_count:200},niedianling:{probability:.2,max_count:50},mengma:{probability:.05,max_count:10}}}}}},T={max_hp:10,attack:1,defense:1,crit_rate:.05,crit_resist:.01,crit_damage:1.5,crit_damage_resist:.1,hit_rate:1,dodge_rate:.1},A={putongyeshou:{name:"普通野兽",desc:"普通野兽",combat_multipliers:{max_hp:1,attack:1,defense:1,crit_rate:1,crit_resist:1,crit_damage:1,crit_damage_resist:1,hit_rate:1,dodge_rate:1}}},$={jingjilu:{name:"荆棘鹿",desc:"森林和草原中常见的野兽，背部长有未硬化的骨质棘刺，蹄部覆盖苔藓状共生植物。遭遇危险时会蜷缩成带刺球体滚动逃离，但常因不够聪明而卡在树根间。",raceId:"putongyeshou",level:1,combat_multipliers:{max_hp:1,attack:1,defense:1,crit_rate:1,crit_resist:1,crit_damage:1,crit_damage_resist:1,hit_rate:1,dodge_rate:1},drop_materials:[{name:"deer_fur",probability:.4},{name:"deer_horn",probability:.4},{name:"deer_fur",probability:.4},{name:"deer_horn",probability:.4}]},niedianling:{name:"蹑电羚",desc:"蹑电羚，肩部生有透明晶状体的羚羊，群居但胆小。",raceId:"putongyeshou",level:2,combat_multipliers:{max_hp:3,attack:2,defense:2,crit_rate:1,crit_resist:1,crit_damage:1,crit_damage_resist:1,hit_rate:1,dodge_rate:1},drop_materials:[{name:"dianling_fur",probability:.4},{name:"dianling_horn",probability:.4}]},shijiaoyezhu:{name:"石角野猪",desc:"重达300公斤的独居生物，头部覆盖矿物沉积形成的灰褐色石甲，冲锋时会在路径上留下持续的扬尘区域。",raceId:"putongyeshou",level:2,combat_multipliers:{max_hp:2,attack:2,defense:4,crit_rate:1,crit_resist:1,crit_damage:1,crit_damage_resist:1,hit_rate:1,dodge_rate:1},drop_materials:[{name:"pig_fur",probability:.4},{name:"pig_fur",probability:.4},{name:"pig_tooth",probability:.2}]},zhendimanniu:{name:"震地蛮牛",desc:"震地蛮牛，森林中少见而危险的生物，体型巨大，拥有尖锐的角和强壮的肌肉。",raceId:"putongyeshou",level:3,combat_multipliers:{max_hp:3,attack:6,defense:3,crit_rate:1,crit_resist:1,crit_damage:1,crit_damage_resist:1,hit_rate:1,dodge_rate:1},drop_materials:[{name:"manniu_fur",probability:.2},{name:"manniu_horn",probability:.2}]},mengma:{name:"巨兽猛犸",desc:"巨兽猛犸，草原上最强大的生物，拥有巨大的象牙和强壮的肌肉。",raceId:"putongyeshou",level:4,combat_multipliers:{max_hp:4,attack:6,defense:4,crit_rate:1,crit_resist:1,crit_damage:1,crit_damage_resist:1,hit_rate:1,dodge_rate:1},drop_materials:[{name:"mengma_fur",probability:.2},{name:"mengma_tooth",probability:.2}]},jianchihu:{name:"剑齿虎",desc:"剑齿虎，森林中最危险的生物，拥有锋利的牙齿和强壮的肌肉。",raceId:"putongyeshou",level:4,combat_multipliers:{max_hp:4,attack:6,defense:4,crit_rate:1,crit_resist:1,crit_damage:1,crit_damage_resist:1,hit_rate:1,dodge_rate:1},drop_materials:[{name:"mjianchihu_fur",probability:.2},{name:"mjianchihu_horn",probability:.2}]}},b={base_combat_stats:T,races:A,creatures:$},E=a=>{const t=b.base_combat_stats,i=b.creatures[a],n=i.raceId,s=b.races[n];if(!s)throw new Error(`Invalid race ID: ${n}`);const e=s.combat_multipliers;if(!i)throw new Error(`Invalid creature ID: ${a}`);const r=i.combat_multipliers,o=i.level||1;return{max_hp:Math.floor(t.max_hp*o*e.max_hp*r.max_hp),attack:Math.floor(t.attack*o*e.attack*r.attack),defense:Math.floor(t.defense*o*e.defense*r.defense),crit_rate:t.crit_rate*e.crit_rate*r.crit_rate,crit_resist:t.crit_resist*e.crit_resist*r.crit_resist,crit_damage:t.crit_damage*e.crit_damage*r.crit_damage,crit_damage_resist:t.crit_damage_resist*e.crit_damage_resist*r.crit_damage_resist,hit_rate:t.hit_rate*e.hit_rate*r.hit_rate,dodge_rate:t.dodge_rate*e.dodge_rate*r.dodge_rate}},X=()=>{const a=m.currentLocationId,t=H[m.currentMapId].locations[a];if(!t||!t.enemy)return;const i=Object.entries(m.enemyStatus).filter(([e,r])=>r.locationId===a);if(i.length>=5)return Promise.resolve();if(!m.locationStatus[a]){const e={...m.locationStatus};e[a]={},Object.keys(t.enemy).forEach(r=>{e[a][r]={remainingCount:t.enemy[r].max_count}}),v({locationStatus:e})}const n=5-i.length,s=Object.entries(t.enemy).filter(([e,r])=>{var c;return(((c=m.locationStatus[a][e])==null?void 0:c.remainingCount)||0)>0});if(s.length===0)return Promise.resolve();for(let e=0;e<n;e++){const r=Math.floor(Math.random()*s.length),[o,c]=s[r];if(Math.random()<=c.probability){const u=`${o}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,p=E(o),_={...m.enemyStatus},d={...m.locationStatus};_[u]={...p,hp:p.max_hp,enemyId:o,locationId:a},d[a][o].remainingCount--,v({enemyStatus:_,locationStatus:d})}if(m.locationStatus[a][o].remainingCount<=0&&(s.splice(r,1),s.length===0))break}return Promise.resolve()};async function D(a,t){const i=[],n=t.drop_materials||[];for(const s of n)if(Math.random()<=s.probability){const e={...a};e.materials=[...e.materials,s.name],await h(e),i.push(s.name)}return i}const l={max_hp:10,attack:1,defense:1,crit_rate:.05,crit_resist:.01,crit_damage:1.5,crit_damage_resist:.1,hit_rate:1,dodge_rate:.1},y={max_hp:1.2,attack:1.15,defense:1.1};async function j(){const a=m.player,t=a.level,i={max_hp:Math.floor(l.max_hp*Math.pow(y.max_hp,t-1)),attack:Math.floor(l.attack*Math.pow(y.attack,t-1)),defense:Math.floor(l.defense*Math.pow(y.defense,t-1)),crit_rate:l.crit_rate,crit_resist:l.crit_resist,crit_damage:l.crit_damage,crit_damage_resist:l.crit_damage_resist,hit_rate:l.hit_rate,dodge_rate:l.dodge_rate};return Object.values(a.equipment).forEach(n=>{n&&Object.keys(n.combat_info).forEach(s=>{i[s]+=n.combat_info[s]})}),await h({...a,combat_stats:i}),Promise.resolve()}async function k(a,t){const i=Math.random(),n=t.hit_rate*(1-a.combat_stats.dodge_rate);if(i<=n){const s=Math.random(),e=t.crit_rate*(1-a.combat_stats.crit_resist),r=s<=e;let o=t.attack-a.combat_stats.defense;if(o=Math.max(1,o),r){const f=t.crit_damage*(1-a.combat_stats.crit_damage_resist);o=Math.floor(o*f)}const c={...a};c.hp=Math.max(0,c.hp-o),await h(c);const u=c.hp>0;return u||await h({...c,hp:120,level:1,gold:0,materials:[],equipment:[]}),{hit:!0,damage:o,isCrit:r,isPlayerAlive:u}}return{hit:!1,damage:0,isCrit:!1,isPlayerAlive:!0}}async function Y(a){const t=m.player,i=t.unequipped.findIndex(r=>r.name===a);if(i===-1)return Promise.reject(new Error("装备不存在"));const n=t.unequipped[i],s=n.position;t.equipment[s]&&t.unequipped.push(t.equipment[s]);const e={...t};e.equipment[s]=n,e.unequipped=[...e.unequipped.slice(0,i),...e.unequipped.slice(i+1)],await h(e),await j()}async function Z(a){const t=m.player;t.combat_stats||await j();const i=m.enemyStatus[a];if(!i)return Promise.reject(new Error("Enemy not found"));const n=i.enemyId,s=b.creatures[n];if(!s)return Promise.reject(new Error("Enemy config not found"));const e=E(n),r=Math.random(),o=t.combat_stats.hit_rate*(1-e.dodge_rate);let c=null;if(r>o)return c=await k(t,e),{player:{hit:!1,damage:0,isCrit:!1},enemy:c};const u=Math.random(),f=t.combat_stats.crit_rate*(1-e.crit_resist),p=u<=f;let _=t.combat_stats.attack-e.defense;if(_=Math.max(1,_),p){const I=t.combat_stats.crit_damage*(1-e.crit_damage_resist);_=Math.floor(_*I)}const d={...m.enemyStatus};d[a].hp-=_;let w=[];return d[a].hp<=0&&(w=await D(t,s),delete d[a],await v({enemyStatus:d})),d[a]&&(c=await k(t,e)),{player:{hit:!0,damage:_,isCrit:p},enemy:c,drops:w}}function tt(){const a=m.player,t=a.level;let i=Math.floor(l.max_hp*Math.pow(y.max_hp,t-1));return Object.values(a.equipment).forEach(n=>{n&&n.combat_info.max_hp&&(i+=n.combat_info.max_hp)}),i}const z={max_hp:"生命值上限",attack:"攻击力",defense:"防御力",crit_rate:"暴击率",crit_resist:"暴击抵抗",crit_damage:"暴击伤害",crit_damage_resist:"暴击伤害抗性",hit_rate:"命中率",dodge_rate:"闪避率"},V={common:{name:"普通的",multiplier:.5,chance:.4399},uncommon:{name:"优秀的",multiplier:1,chance:.3},rare:{name:"精良的",multiplier:3,chance:.159},epic:{name:"史诗的",multiplier:12,chance:.1},legendary:{name:"传说的",multiplier:60,chance:.001},mythic:{name:"神话的",multiplier:360,chance:1e-4}},F={weapon:{name:"武器",stats:["attack"],stat_multipliers:{attack:2,defense:.5}},body:{name:"护甲",stats:["defense"],stat_multipliers:{attack:.5,defense:1}},feet:{name:"靴子",stats:["defense"],stat_multipliers:{attack:1,defense:1}},head:{name:"头盔",stats:["defense"],stat_multipliers:{attack:.5,defense:1}}},et={combat_stats:z,equipment_levels:V,equipment_position:F},G={__name:"Modal",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(a,{emit:t}){const i=t,n=()=>{i("update:visible",!1)};return(s,e)=>a.visible?(x(),S("div",{key:0,class:"modal-overlay",onClick:n},[g("div",{class:"modal-content",onClick:e[0]||(e[0]=P(()=>{},["stop"]))},[q(s.$slots,"default",{},void 0)])])):C("",!0)}},N=M(G,[["__scopeId","data-v-b52e14f0"]]),U={class:"message-container"},W=["innerHTML"],J={key:0,class:"message-actions"},K={__name:"Message",props:{content:{type:String,required:!0},visible:{type:Boolean,default:!1},showButton:{type:Boolean,default:!1},buttonText:{type:String,default:"确定"},allowClose:{type:Boolean,default:!0}},emits:["update:visible","action"],setup(a,{emit:t}){const i=a,n=t,s=()=>{n("action"),n("update:visible",!1)},e=B({get:()=>i.visible,set:r=>{!i.allowClose&&!r||n("update:visible",r)}});return(r,o)=>(x(),L(N,{visible:e.value,"onUpdate:visible":o[0]||(o[0]=c=>e.value=c),"allow-close":a.allowClose},{default:O(()=>[g("div",U,[g("div",{class:"message-content",innerHTML:a.content},null,8,W),a.showButton?(x(),S("div",J,[g("button",{class:"action-button",onClick:s},R(a.buttonText),1)])):C("",!0)])]),_:1},8,["visible","allow-close"]))}},at=M(K,[["__scopeId","data-v-c67c0a88"]]);export{at as M,E as a,Z as b,Y as c,tt as d,b as e,j as f,X as g,et as i,H as m};
